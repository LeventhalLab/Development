R0088_unitList = {'R0088_20151030a_T8_ch[42 44 46 48]a',...
                'R0088_20151030a_T8_ch[42 44 46 48]b',...
                'R0088_20151030a_T8_ch[42 44 46 48]c',...
                'R0088_20151030a_T8_ch[42 44 46 48]d',...
                'R0088_20151030a_T8_ch[42 44 46 48]e',...
                'R0088_20151031a_T8_ch[42 44 46 48]a',...
                'R0088_20151031a_T5_ch[33 35 37 39]a',...
                'R0088_20151031a_T5_ch[33 35 37 39]b',...
                'R0088_20151031a_T7_ch[34 36 38 40]a',...
                'R0088_20151031a_T7_ch[34 36 38 40]a',...
                'R0088_20151031a_T7_ch[34 36 38 40]b',...
                'R0088_20151031a_T7_ch[34 36 38 40]c',...
                'R0088_20151031a_T8_ch[42 44 46 48]a',...
                'R0088_20151031a_T8_ch[42 44 46 48]b',...
                'R0088_20151031a_T8_ch[42 44 46 48]c',...
                'R0088_20151031a_T8_ch[42 44 46 48]d',...
                'R0088_20151101a_T5_ch[33 35 37 39]b',...
                'R0088_20151101a_T5_ch[33 35 37 39]c',...
                'R0088_20151101a_T5_ch[33 35 37 39]d',...
                'R0088_20151101a_T7_ch[34 36 38 40]a',...
                'R0088_20151101a_T7_ch[34 36 38 40]b',...
                'R0088_20151101a_T7_ch[34 36 38 40]c',...
                'R0088_20151101a_T8_ch[42 44 46 48]a',...
                'R0088_20151101a_T8_ch[42 44 46 48]b',...
                'R0088_20151101a_T8_ch[42 44 46 48]c',...
                'R0088_20151102a_T5_ch[33 35 37 39]a',...
                'R0088_20151102a_T5_ch[33 35 37 39]b',...
                'R0088_20151102a_T5_ch[33 35 37 39]c',...
                'R0088_20151102a_T5_ch[33 35 37 39]d',...
                'R0088_20151102a_T7_ch[34 36 38 40]b',...
                'R0088_20151102a_T7_ch[34 36 38 40]c',...
                'R0088_20151102a_T8_ch[42 44 46 48]b',...
                'R0088_20151102a_T8_ch[42 44 46 48]c',...
                'R0088_20151102a_T8_ch[42 44 46 48]d'};
            
R0117_unitList = {'R0117_20160503a_T23_ch[0 0 0 104]a',...
                  'R0117_20160503a_T25_ch[0 0 0 120]a',...
                  'R0117_20160503a_T31_ch[0 0 0 95]a',...
                  'R0117_20160503a_T31_ch[0 0 93 0]a',...
                  'R0117_20160503b_T23_ch[0 0 0 104]a',...
                  'R0117_20160503b_T25_ch[0 0 0 120]a',...
                  'R0117_20160503b_T31_ch[0 0 0 95]a',...
                  'R0117_20160503b_T31_ch[0 0 93 0]a',...
                  'R0117_20160504a_T23_ch[0 0 0 104]a',...
                  'R0117_20160504a_T25_ch[0 0 118 0]b',...
                  'R0117_20160504a_T31_ch[0 0 93 0]a',...
                  'R0117_20160505a_T23_ch[0 0 0 104]a',...
                  'R0117_20160505a_T25_ch[0 0 118 0]a',...
                  'R0117_20160505a_T31_ch[0 0 93 0]a',...
                  'R0117_20160506a_T23_ch[98 0 0 0]b',...
                  'R0117_20160506a_T25_ch[0 0 118 0]a',...
                  'R0117_20160506a_T25_ch[0 0 118 0]b',...
                  'R0117_20160508a_T23_ch[0 0 0 104]a',...
                  'R0117_20160510a_T23_ch[0 0 0 104]a'};
            
%                 'R0088_20151101a_T7_ch[34 36 38 40]d',...  % questionnable one
            
ratID = 'R0088';
ratID = 'R0117';
unitList = eval([ratID '_unitList']);

rootDir = '/Volumes/Tbolt_02/VM thal analysis';

ratFolderName = [ratID '_spike_triggered_scalos'];
ratFolderName = fullfile(rootDir, ratFolderName);
cd(ratFolderName);

load('/Volumes/Tbolt_02/VM thal analysis/R0088_spike_triggered_scalos/R0088_20151030a/R0088_20151030a_T8_ch[42 44 46 48]a_scalos_trialsOnly.mat');
% test file

scalo_across_units = zeros(length(allTsScalograms), size(allTsScalograms{1},2), size(allTsScalograms{1},3));
log_scalo_across_units = zeros(length(allTsScalograms), size(allTsScalograms{1},2), size(allTsScalograms{1},3));
num_scalos = 0;
for iUnit = 1 : length(unitList)
    
    curUnit = unitList{iUnit};
    sessionName = curUnit(1:15);
    
    sessionFolderName = fullfile(ratFolderName, sessionName);
    
    fname = [curUnit '_scalos_trialsOnly.mat'];
    fname = fullfile(sessionFolderName, fname);
    
    load(fname);
    num_scalos = num_scalos + 1;
    for ii = 1 : length(allTsScalograms)
        temp = squeeze(scalo_across_units(ii,:,:));
        temp = temp + squeeze(allTsScalograms{ii});
        scalo_across_units(ii,:,:) = temp;
        temp = squeeze(log_scalo_across_units(ii,:,:));
        temp = temp + squeeze(all_logTsScalograms{ii});
        log_scalo_across_units(ii,:,:) = temp;
                                 
    end

end

scalo_across_units = scalo_across_units / num_scalos;
log_scalo_across_units = log_scalo_across_units / num_scalos;